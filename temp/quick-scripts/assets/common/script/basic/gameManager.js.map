{"version":3,"sources":["gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","coin","on","eventType","gameOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","wx","login","success","getUserInfo","fail","res","errMsg","indexOf","console","log","nickName","userInfo","avatarUrl","e","data","gameState","GameState","Play","leaveRoomInfo","owner","id","isRoomOwner","Over","concat","playerUserIds","sort","a","b","playerA","PlayerManager","getPlayerByUserId","playerB","score","Canvas","instance","designResolution","height","width","uiFunc","openUI","obj","uiResultScript","setData","bind","startGame","readyCnt","Pause","loadScene","sendReadyMsg","initPlayers","syncFrame","result","engine","setFrameSync","FRAME_RATE","setFrameSyncResponse","rsp","mStatus","status","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","frameUpdate","channel","platform","gameId","dispatch","kickPlayerRsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","removePersistRootNode","error","msg","uiTip","logout","registerUser","deviceId","gatewayId","token","gameVersion","appKey","secret","info","lobbyShow","None","cpProto","JSON","parse","GAME_START_EVENT","scores","self","remoteUserIds","userIds","forEach","push","playerId","player","PLAYER_FIRE_EVENT","srcUserId","worldPos","convertToWorldSpaceAR","v2","bulletPoint","parent","convertToNodeSpaceAR","bulletType","BulletType","Normal","BulletManager","spawnSmallBullet","Special","spawnBigBullet","GAME_TIME","gameTime","parseInt","time","SCORE_EVENT","addScore","updateCoin","GAME_OVER_EVENT","Math","floor","READY","length","sendRoundStartMsg","ROUND_START","GameSeconds","timeUpdate","roundStart","action","sendEventEx","i","frameItems","PLAYER_ROTATION_EVENT","srcUserID","setRotation","rotation","clearInterval","timeId","setInterval","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","isOpen","send","userInfoReq","userId","stringify"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../../assets/common/script/basic","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    blockInput() {\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\n        setTimeout(function() {\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\n        }, 500);\n    },\n\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        this.coin = 100;\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        this.network = window.network;\n        this.network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n        try {\n            wx.login({\n                success: function() {\n                    wx.getUserInfo({\n                        fail: function(res) {\n                            // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                            if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                                // 处理用户拒绝授权的情况\n                                console.log(\"fail\");\n                            }\n                        },\n                        success: function(res) {\n                            Game.GameManager.nickName = res.userInfo.nickName;\n                            Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\n                            console.log('success', Game.GameManager.nickName);\n                        }\n                    });\n                }\n            })\n        } catch (e) {\n        }\n    },\n\n    leaveRoom: function(data) {\n        //切换房主\n        if (Game.GameManager.gameState === GameState.Play) {\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\n                GLB.isRoomOwner = true;\n            }\n        }\n    },\n\n    gameOver: function() {\n        // 打开结算界面--\n        console.log(\"游戏结束\");\n        if (Game.GameManager.gameState !== GameState.Over) {\n            Game.GameManager.gameState = GameState.Over;\n            var data = [].concat(GLB.playerUserIds);\n            data.sort(function(a, b) {\n                var playerA = Game.PlayerManager.getPlayerByUserId(a);\n                var playerB = Game.PlayerManager.getPlayerByUserId(b);\n                if (playerA && playerB) {\n                    if (playerB.score !== playerA.score) {\n                        return playerB.score - playerA.score;\n                    } else {\n                        if (a === GLB.userInfo.id) {\n                            return -1;\n                        } else if (b === GLB.userInfo.id) {\n                            return 1;\n                        }\n                    }\n                }\n                return a - b;\n            })\n\n            setTimeout(function() {\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                    uiFunc.openUI(\"uiResultVer\", function(obj) {\n                        var uiResultScript = obj.getComponent(\"uiResult\");\n                        if (uiResultScript) {\n                            uiResultScript.setData(data);\n                        }\n                    });\n                } else {\n                    uiFunc.openUI(\"uiResult\", function(obj) {\n                        var uiResultScript = obj.getComponent(\"uiResult\");\n                        if (uiResultScript) {\n                            uiResultScript.setData(data);\n                        }\n                    });\n                }\n            }.bind(this), 1500);\n        }\n    },\n\n    startGame: function() {\n        this.readyCnt = 0;\n        this.gameState = GameState.Pause;\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n                Game.PlayerManager.initPlayers();\n            }.bind(this));\n        }.bind(this));\n\n        if (GLB.syncFrame === true && GLB.isRoomOwner === true) {\n            var result = mvs.engine.setFrameSync(GLB.FRAME_RATE);\n            if (result !== 0) {\n                console.log('设置帧同步率失败,错误码:' + result);\n            }\n        }\n    },\n\n    setFrameSyncResponse: function(rsp) {\n        if (rsp.mStatus !== 200) {\n            console.log('设置同步帧率失败，status=' + rsp.status);\n        } else {\n            console.log('设置同步帧率成功, 帧率为:' + GLB.FRAME_RATE);\n        }\n    },\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n        mvs.response.frameUpdate = this.frameUpdate.bind(this);\n        mvs.response.setFrameSyncResponse = this.setFrameSyncResponse.bind(this);\n\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n        Game.GameManager.blockInput();\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        console.log(\"reload lobby\");\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        );\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            GLB.playerUserIds = [GLB.userInfo.id]\n            this.scores = [];\n            var self = this;\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            remoteUserIds.forEach(function(id) {\n                if (GLB.userInfo.id !== id) {\n                    GLB.playerUserIds.push(id)\n                }\n                var score = {\n                    playerId: id,\n                    score: 0\n                }\n                self.scores.push(score);\n            });\n            this.startGame();\n        }\n\n        var player = null;\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                var worldPos = player.node.convertToWorldSpaceAR(cc.v2(0, 177));\n                var bulletPoint = player.node.parent.parent.convertToNodeSpaceAR(worldPos);\n                if (cpProto.bulletType === BulletType.Normal) {\n                    Game.BulletManager.spawnSmallBullet(player.node, bulletPoint);\n                } else if (cpProto.bulletType === BulletType.Special) {\n                    Game.BulletManager.spawnBigBullet(player.node, bulletPoint);\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.GAME_TIME) >= 0) {\n            this.gameTime = parseInt(cpProto.time);\n            if (cpProto.time < 0) {\n                cpProto.time = 0;\n            }\n            clientEvent.dispatch(clientEvent.eventType.time, cpProto.time);\n        }\n\n        if (info.cpProto.indexOf(GLB.SCORE_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.addScore(cpProto.score);\n            }\n            if (info.srcUserId === GLB.userInfo.id) {\n                this.coin += cpProto.score / 5;\n                clientEvent.dispatch(clientEvent.eventType.updateCoin);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.GAME_OVER_EVENT) >= 0) {\n            clientEvent.dispatch(clientEvent.eventType.gameOver);\n            this.coin = Math.floor(this.coin);\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            setTimeout(function() {\n                Game.GameManager.gameState = GameState.Play;\n                this.gameTime = Game.GameSeconds;\n                this.timeUpdate();\n            }.bind(this), 7000);\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\n        }\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    frameUpdate: function(rsp) {\n        for (var i = 0; i < rsp.frameItems.length; i++) {\n            var info = rsp.frameItems[i];\n            if (info && info.cpProto && info.srcUserId !== GLB.userInfo.id) {\n                if (info.cpProto.indexOf(GLB.PLAYER_ROTATION_EVENT) >= 0) {\n                    var cpProto = JSON.parse(info.cpProto);\n                    if (Game.PlayerManager) {\n                        var player = Game.PlayerManager.getPlayerByUserId(info.srcUserID);\n                        if (player) {\n                            player.setRotation(cpProto.rotation);\n                        }\n                    }\n                }\n            }\n        }\n    },\n\n    timeUpdate: function() {\n        var self = this;\n        clearInterval(this.timeId);\n        this.timeId = setInterval(function() {\n            if (GLB.isRoomOwner) {\n                var time = self.gameTime - 1;\n                var msg = {\n                    action: GLB.GAME_TIME,\n                    time: time\n                };\n                Game.GameManager.sendEventEx(msg);\n                if (time < 0 || this.gameState === GameState.Over || this.gameState === GameState.None) {\n                    clearInterval(this.timeId);\n                    var msg = {\n                        action: GLB.GAME_OVER_EVENT,\n                    };\n                    Game.GameManager.sendEventEx(msg);\n                }\n            } else {\n                if (self.gameTime < 0 || this.gameState === GameState.Over || this.gameState === GameState.None) {\n                    clearInterval(this.timeId);\n                }\n            }\n        }.bind(this), 1000);\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    if (!this.network.isOpen()) {\n                        return;\n                    }\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game3\"\n                        });\n                    }.bind(this), 500);\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game3\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    }\n});\n"]}